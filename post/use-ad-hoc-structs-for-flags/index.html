<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.104.3"><title>Use ad hoc structs for command-line flags in Go | Gunnar Þór Magnússon</title><link rel=canonical href=https://gunnihinn.github.io/post/use-ad-hoc-structs-for-flags/><link rel=stylesheet href=https://gunnihinn.github.io/css/base.min.c8d7b76018962ae348ca009f0c82f2ed51a7ad01f94e2091060a820b89493837.css integrity="sha256-yNe3YBiWKuNIygCfDILy7VGnrQH5TiCRBgqCC4lJODc=" crossorigin=anonymous></head><body><nav class=u-background><div class=u-wrapper><ul class=Banner><li class="Banner-item Banner-item--title"><a class="Banner-link u-clickable" href=https://gunnihinn.github.io>Gunnar Þór Magnússon</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://gunnihinn.github.io/about/>About</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://gunnihinn.github.io/post/>Posts</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://gunnihinn.github.io/index.xml>RSS</a></li></ul></div></nav><main><div class=u-wrapper><div class=u-padding><article><header class=Heading><h2 class=Heading-title><a class="Heading-link u-clickable" href=https://gunnihinn.github.io/post/use-ad-hoc-structs-for-flags/ rel=bookmark>Use ad hoc structs for command-line flags in Go</a></h2><time datetime=2020-06-29T09:15:48+02:00>29 June, 2020</time></header><div class=paragraph><p>The path of least resistance to commandline flag parsing in Go is to use the <a href=https://golang.org/pkg/flag/>flag</a> package from the standard library. A lot of times the result looks like this:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-go data-lang=go>func main() {
  help := flags.Bool(&#34;help&#34;, false, &#34;HALP&#34;)
  frobinate := flags.Int(&#34;frobinate&#34;, 0, &#34;Amount to frobinate by&#34;)
  blargalarg := flags.String(&#34;blargalarg&#34;, &#34;&#34;, &#34;Social media comment&#34;)
  // [713 variables later]
  flag.Parse()

  // Much later
  if *blargalarg != &#34;&#34; {
    // Do things. We may or may not remember what this variable is.
  }
}</code></pre></div></div><div class=paragraph><p>That is, we have a bunch of variables lying around we don’t really care about and take up perfectly good names. If we see one of them later in the program, we don’t have any context on where it comes from, so we have to start jumping around in the source.</p></div><div class=paragraph><p>In my projects I’ve used a little accounting trick to hold these flags. I find it helps me deal with them. We just define an anonymous struct to hold the flags:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-go data-lang=go>func main() {
  flags := struct{
    help *bool
    frobinate *int
    blargalarg *string
    // [713 field definitions]
  }{
    help: flags.Bool(&#34;help&#34;, false, &#34;HALP&#34;),
    frobinate: flags.Int(&#34;frobinate&#34;, 0, &#34;Amount to frobinate by&#34;),
    blargalarg: flags.String(&#34;blargalarg&#34;, &#34;&#34;, &#34;Social media comment&#34;),
    // [713 field instantiations]
  }
  flag.Parse()

  // Much later
  if *flags.blargalarg != &#34;&#34; {
    // AAAAAH YES IT&#39;S A FLAG
  }
}</code></pre></div></div><div class=paragraph><p>If I really need to, I can pull the anonymous struct out into its own global variable or type definition or whatever, and pass it around as arguments to functions that deal with its contents. That is not as handy with a litter of flag variables. But really I just find that defining all these flags clearly in one place makes the program easier to read later once I’ve forgotten what it does.</p></div></article></div></div></main><footer class=Footer><div class=u-wrapper><div class=u-padding>Copyright 2018-2020 :: Gunnar Þór Magnússon</div></div><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></footer></body></html>